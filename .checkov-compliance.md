# Checkov Dockerfile Compliance

> üìñ [Back to README](../README.md)

This document describes the Checkov compliance status of the Dockerfiles in this project.

## Compliance Status

Both Dockerfiles are **Checkov compliant** with appropriate exceptions documented below.

## Dockerfile (Distroless)

**Location**: `Dockerfile`

**Compliance**: ‚úÖ Compliant (with documented exception)

**Checkov Rules Compliance**:

| Rule ID | Rule | Status | Notes |
|---------|------|--------|-------|
| CKV_DOCKER_1 | Port 22 not exposed | ‚úÖ | Exposes port 8080, not 22 |
| CKV_DOCKER_2 | HEALTHCHECK exists | ‚ö†Ô∏è | **Skipped** - Distroless doesn't support HEALTHCHECK. Health checks done externally. |
| CKV_DOCKER_3 | User created | ‚úÖ | Uses `nonroot:nonroot` user |
| CKV_DOCKER_4 | COPY instead of ADD | ‚úÖ | Uses COPY throughout |
| CKV_DOCKER_5 | Update not alone | ‚úÖ | No standalone update commands |
| CKV_DOCKER_6 | LABEL maintainer | ‚úÖ | Uses LABEL (not deprecated MAINTAINER) |
| CKV_DOCKER_7 | Non-latest tag | ‚úÖ | Uses `golang:1.25-alpine` and `distroless/static-debian12:nonroot` |
| CKV_DOCKER_8 | Last USER not root | ‚úÖ | Uses non-root user |
| CKV_DOCKER_9 | APT not used | ‚úÖ | Uses Alpine (apk), not APT |
| CKV_DOCKER_10 | WORKDIR absolute | ‚úÖ | Uses `/build` and `/app` |
| CKV_DOCKER_11 | FROM alias unique | ‚úÖ | Uses unique alias `builder` |

**Exception**: CKV_DOCKER_2 (HEALTHCHECK) is skipped for this Dockerfile because distroless images don't include shell utilities needed for HEALTHCHECK. Health checks should be performed externally via HTTP requests to the `/health` endpoint.

## Dockerfile.alpine

**Location**: `Dockerfile.alpine`

**Compliance**: ‚úÖ Fully Compliant

**Checkov Rules Compliance**:

| Rule ID | Rule | Status | Notes |
|---------|------|--------|-------|
| CKV_DOCKER_1 | Port 22 not exposed | ‚úÖ | Exposes port 8080, not 22 |
| CKV_DOCKER_2 | HEALTHCHECK exists | ‚úÖ | Includes HEALTHCHECK with wget |
| CKV_DOCKER_3 | User created | ‚úÖ | Creates and uses `appuser` |
| CKV_DOCKER_4 | COPY instead of ADD | ‚úÖ | Uses COPY throughout |
| CKV_DOCKER_5 | Update not alone | ‚úÖ | Uses `apk --no-cache add` (not standalone update) |
| CKV_DOCKER_6 | LABEL maintainer | ‚úÖ | Uses LABEL (not deprecated MAINTAINER) |
| CKV_DOCKER_7 | Non-latest tag | ‚úÖ | Uses `golang:1.25-alpine` and `alpine:3.20` |
| CKV_DOCKER_8 | Last USER not root | ‚úÖ | Uses non-root `appuser` |
| CKV_DOCKER_9 | APT not used | ‚úÖ | Uses Alpine (apk), not APT |
| CKV_DOCKER_10 | WORKDIR absolute | ‚úÖ | Uses `/build` and `/app` |
| CKV_DOCKER_11 | FROM alias unique | ‚úÖ | Uses unique alias `builder` |

## CI/CD Integration

Checkov scans are automatically run in the CI/CD pipeline:

- **Workflow**: `.github/workflows/build-and-push.yml`
- **Job**: `dockerfile-scan`
- **When**: Before building containers
- **Action**: `bridgecrewio/checkov-action@master`

### Scanning Configuration

- **Dockerfile (distroless)**: Scanned with `CKV_DOCKER_2` skipped
- **Dockerfile.alpine**: Scanned with all checks enabled
- **Output**: SARIF format uploaded to GitHub Security
- **Failure**: Build fails if critical issues found

## Best Practices Implemented

1. **Multi-stage builds**: Both Dockerfiles use multi-stage builds to minimize final image size
2. **Non-root users**: Both run as non-root users for security
3. **Minimal base images**: Distroless for production, Alpine for debugging
4. **Specific version tags**: No `latest` tags used
5. **COPY over ADD**: Using COPY for better caching and security
6. **Absolute WORKDIR paths**: Using absolute paths for clarity
7. **Health checks**: Alpine variant includes HEALTHCHECK
8. **No standalone updates**: Package installation combined with operations

## Manual Scanning

To scan Dockerfiles manually:

```bash
# Scan Dockerfile (distroless)
checkov -f Dockerfile --framework dockerfile

# Scan Dockerfile.alpine
checkov -f Dockerfile.alpine --framework dockerfile

# Scan both
checkov -d . --framework dockerfile
```

## References

- [Checkov Dockerfile Policy Index](https://www.checkov.io/5.Policy%20Index/dockerfile.html)
- [Dockerfile Best Practices](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
- [Distroless Images](https://github.com/GoogleContainerTools/distroless)

## Related Documentation

- üìñ [README.md](../README.md) - Main project documentation
- üê≥ [README.Docker.md](../README.Docker.md) - Docker build and deployment guide
- üîí [.github/workflows/README.md](../.github/workflows/README.md) - CI/CD workflow documentation
